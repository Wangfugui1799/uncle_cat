<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepStory AI - 智能小说创作工具</title>
    <!-- 使用CDN链接替代本地依赖 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Global Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1c1917;
            border-left: 1px solid #292524;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #57534e;
            border-radius: 5px;
            border: 2px solid #1c1917;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #78716c;
        }

        /* Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: #57534e #1c1917;
        }

        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .animate-in {
            animation: fadeIn 0.2s ease-out;
        }

        .zoom-in-95 {
            animation: zoomIn 0.2s ease-out;
        }

        /* Custom styles */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #57534e #1c1917;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1c1917;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #57534e;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #78716c;
        }

        /* Loading animation */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Markdown viewer styles */
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #fbbf24;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .markdown-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .markdown-content code {
            background-color: #374151;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
        }

        .markdown-content pre {
            background-color: #1f2937;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body class="bg-stone-950 text-stone-300 min-h-screen">
    <div id="root"></div>

    <script>
        // 常量定义
        const TAGS = {
            male: ['全部', '东方仙侠', '科幻末世', '都市日常', '都市修真', '都市高武', '历史古代', '战神赘婿', '都市种田', '传统玄幻', '历史脑洞', '悬疑脑洞', '都市脑洞', '游戏体育', '抗战谍战', '动漫衍生', '男频衍生'],
            female: ['全部', '现代言情', '古代言情', '年代种田', '悬疑灵异', '玄幻脑洞', '豪门总裁', '宫斗宅斗', '穿越重生', '快穿系统', '种田经商', '仙侠奇缘', '青春校园', '悬疑推理', '动漫衍生']
        };

        const STORY_TONES = [
            { label: '喜剧[欢快]', value: '喜剧' },
            { label: '悲剧[虐心]', value: '悲剧' },
            { label: '正剧[严肃]', value: '正剧' },
            { label: '轻松[休闲]', value: '轻松' },
            { label: '爆笑[搞怪]', value: '爆笑' },
            { label: '暗黑[阴郁]', value: '暗黑' }
        ];

        const ENDING_TYPES = [
            { label: '圆满[喜结]', value: '圆满' },
            { label: '悲剧[遗憾]', value: '悲剧' },
            { label: '开放[余地]', value: '开放' },
            { label: '反转[意外]', value: '反转' },
            { label: '循环[首尾]', value: '循环' },
            { label: '模糊[迷离]', value: '模糊' },
            { label: '希望[向上]', value: '希望' },
            { label: '悬念[谜团]', value: '悬念' },
            { label: '象征[寓意]', value: '象征' },
            { label: '现实[写实]', value: '现实' }
        ];

        const NARRATIVE_PERSPECTIVES = [
            { label: '第一人称[代入感强]', value: '第一人称' },
            { label: '第三人称全知[视角全面]', value: '第三人称全知' },
            { label: '第三人称限制[聚焦特定]', value: '第三人称限制' },
            { label: '多视角[多角度]', value: '多视角' },
            { label: '旁观者[局外人]', value: '旁观者' }
        ];

        const PLOT_STRUCTURES = [
            { id: 1, name: '三幕式结构（Three-Act Structure）', description: '第一幕：设定世界/角色登场/诱因事件\n第二幕：尝试/对抗/中点大事件/转折危机\n第三幕：高潮决战/问题解决/结尾收束' },
            { id: 2, name: '四幕式结构（Four-Act Structure）', description: '第一幕：设定与诱因\n第二幕：初步尝试\n第三幕：危机升级\n第四幕：高潮解决与结尾' },
            { id: 3, name: '五幕结构（Five-Act Structure）', description: '暴露（Exposition）\n上升动作（Rising Action）\n高潮（Climax）\n下降动作（Falling Action）\n结局（Denouement）' }
        ];

        const STEPS = [
            { id: 'init', title: '创作初始化', description: '设置小说基本信息和核心脑洞' },
            { id: 'dna', title: '核心DNA', description: '构建故事的核心冲突和发展逻辑' },
            { id: 'globalSummary', title: '全局概述', description: '生成故事的整体框架和发展脉络' },
            { id: 'characters', title: '角色设计', description: '创建故事中的主要角色和关系' },
            { id: 'world', title: '世界观设定', description: '构建故事发生的背景世界' },
            { id: 'plot', title: '剧情设计', description: '详细规划故事的情节发展' },
            { id: 'blueprint', title: '创作蓝图', description: '生成完整的小说创作指导' }
        ];

        // API 服务
        const generateContent = async (systemPrompt, userPrompt, config) => {
            const safeConfig = config || {};
            const apiKeyToUse = safeConfig?.apiKey?.trim() || "";
            const baseUrl = safeConfig?.baseUrl?.trim() || "https://generativelanguage.googleapis.com";
            
            if (!apiKeyToUse) {
                throw new Error('API密钥不能为空，请检查API配置。');
            }
            
            const textModel = safeConfig?.textModel === 'custom' ? safeConfig.customTextModel || 'gpt-4o' : (safeConfig?.textModel?.trim() || "gemini-2.5-flash");

            const isGemini = baseUrl.includes('generativelanguage.googleapis.com');
            const isClaude = baseUrl.includes('anthropic.com') || safeConfig?.provider === 'claude';
            
            let url = '';
            if (isGemini) {
                url = `${baseUrl}/v1beta/models/${textModel}:generateContent?key=${apiKeyToUse}`;
            } else if (isClaude) {
                let cleanBase = baseUrl.replace(/\/+$/, '');
                if (cleanBase.endsWith('/v1/messages')) {
                    url = cleanBase;
                } else if (cleanBase.endsWith('/v1')) {
                    url = `${cleanBase}/messages`;
                } else {
                    url = `${cleanBase}/v1/messages`;
                }
            }
            // 其他模型的处理逻辑...
        };

        // Markdown 查看器组件
        const MarkdownViewer = ({ content, className }) => {
            const htmlContent = React.useMemo(() => {
                if (!content) return '';
                
                return content
                    // 标题
                    .replace(/^# (.*$)/gm, '<h1 class="text-2xl font-bold">$1</h1>')
                    .replace(/^## (.*$)/gm, '<h2 class="text-xl font-bold">$1</h2>')
                    .replace(/^### (.*$)/gm, '<h3 class="text-lg font-bold">$1</h3>')
                    // 段落
                    .replace(/^(?!#)([\s\S]*?)(?=^#|\n\n|$)/gm, '<p>$1</p>')
                    // 代码块
                    .replace(/```([\s\S]*?)```/gm, '<pre><code>$1</code></pre>')
                    // 行内代码
                    .replace(/`([^`]+)`/g, '<code>$1</code>');
            }, [content]);

            return React.createElement('div', {
                className: `markdown-content ${className || ''}`,
                dangerouslySetInnerHTML: { __html: htmlContent }
            });
        };

        // 弹窗组件
        const AlertProvider = ({ children }) => {
            const [alert, setAlert] = React.useState(null);

            const showAlert = (message, type = 'info') => {
                setAlert({ message, type });
                setTimeout(() => setAlert(null), 3000);
            };

            return React.createElement('div', null, [
                children,
                alert && React.createElement('div', {
                    key: 'alert',
                    className: `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-y-0 opacity-100 ${alert.type === 'success' ? 'bg-green-600 text-white' : alert.type === 'error' ? 'bg-red-600 text-white' : alert.type === 'warning' ? 'bg-yellow-600 text-white' : 'bg-blue-600 text-white'}`
                }, alert.message)
            ]);
        };

        // 主应用组件
        const App = () => {
            const [inputs, setInputs] = React.useState({
                topic: '',
                genre: '',
                novelTitle: '',
                tone: '',
                ending: '',
                perspective: '',
                numberOfChapters: '',
                wordCount: '',
                customRequirements: ''
            });

            const [apiConfig, setApiConfig] = React.useState({
                provider: 'google',
                baseUrl: 'https://generativelanguage.googleapis.com',
                apiKey: '',
                textModel: 'gemini-2.5-flash'
            });

            const [generatedData, setGeneratedData] = React.useState({
                dna: null,
                globalSummary: null,
                characters: null,
                world: null,
                plot: null,
                blueprint: null,
                state: null,
                chapters: [],
                stateHistory: []
            });

            const [isGenerating, setIsGenerating] = React.useState(false);
            const [loadingMessage, setLoadingMessage] = React.useState("");
            const [showConfigModal, setShowConfigModal] = React.useState(false);
            const [currentStep, setCurrentStep] = React.useState(0);

            // 初始化时加载配置
            React.useEffect(() => {
                const savedConfig = localStorage.getItem('deepstory_config');
                if (savedConfig) {
                    try {
                        const parsedConfig = JSON.parse(savedConfig);
                        setApiConfig({
                            provider: parsedConfig.provider || 'google',
                            ...parsedConfig
                        });
                    } catch (e) { console.error("Config load error", e); }
                }
            }, []);

            const handleConfigSave = (config) => {
                setApiConfig(config);
                localStorage.setItem('deepstory_config', JSON.stringify(config));
            };

            const handleGenerate = async (step) => {
                if (!apiConfig.apiKey) {
                    // 如果没有API密钥，使用模拟数据
                    simulateGenerate(step);
                    return;
                }

                setIsGenerating(true);
                setLoadingMessage(`正在生成${STEPS[step].title}...`);

                try {
                    // 实际API调用逻辑
                    // const result = await generateContent(systemPrompt, userPrompt, apiConfig);
                    // 暂时使用模拟数据
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    simulateGenerate(step);
                } catch (error) {
                    console.error('生成失败:', error);
                    // 显示错误信息
                } finally {
                    setIsGenerating(false);
                    setLoadingMessage("");
                }
            };

            const simulateGenerate = (step) => {
                // 模拟生成内容
                let content = '';
                switch (step) {
                    case 0: // 创作初始化
                        content = `## 基础设定 (BASIC_SETTINGS)
- 小说名称：${inputs.novelTitle || '未命名小说'}
- 核心脑洞：${inputs.topic}
- 题材分类：${inputs.genre}
- 叙事视角：${inputs.perspective}
- 故事基调：${inputs.tone}
- 结局倾向：${inputs.ending}
- 预计章节数：${inputs.numberOfChapters}章
- 每章字数：${inputs.wordCount}字
- 自定义特殊要求：${inputs.customRequirements}

## 核心DNA (STORY_DNA)
当${inputs.topic.split('，')[0] || '主角'}遭遇${inputs.topic.split('，')[1] || '核心冲突事件'}，必须${inputs.topic.split('，')[2] || '关键行动选择'}，否则${inputs.topic.split('，')[3] || '具体的灾难后果'}；与此同时，隐藏的更大危机正在悄然发酵。`;
                        break;
                    case 1: // 核心DNA
                        content = `## 核心DNA详细设计
基于您的创作设定，这是一个具有强大潜力的故事框架。核心冲突围绕${inputs.topic}展开，通过${inputs.perspective}视角展现${inputs.tone}的情感基调。

### 核心冲突
1. 主要冲突：主角面临的直接挑战
2. 次要冲突：推动故事发展的辅助矛盾
3. 深层冲突：故事想要表达的核心主题`;
                        break;
                    case 2: // 全局概述
                        content = `## 故事全局概述
这是一个关于${inputs.topic}的精彩故事。故事发生在一个充满想象力的世界中，主角将经历一系列挑战和成长。

### 故事结构
- 开端：介绍主角和世界观
- 发展：冲突升级，主角面临考验
- 高潮：最终对决，解决核心冲突
- 结局：故事收尾，主题升华`;
                        break;
                    case 3: // 角色设计
                        content = `## 主要角色设计
### 主角
- 姓名：待定
- 背景：普通但不平凡的身份
- 性格：勇敢、善良但有缺陷
- 目标：解决核心冲突，实现自我成长

### 配角
- 姓名：待定
- 关系：主角的朋友/导师/敌人
- 作用：推动情节发展，衬托主角`;
                        break;
                    case 4: // 世界观设定
                        content = `## 世界观设定
### 世界背景
这是一个${inputs.genre}类型的世界，充满了奇妙的设定和规则。

### 核心规则
1. 世界运行的基本法则
2. 特殊能力或技术
3. 社会结构和文化`;
                        break;
                    case 5: // 剧情设计
                        content = `## 剧情详细设计
### 第一部分：开端
- 场景1：介绍主角和日常
- 场景2：冲突的开始
- 场景3：主角的决定

### 第二部分：发展
- 场景4：挑战和成长
- 场景5：盟友和敌人
- 场景6：危机升级

### 第三部分：高潮与结局
- 场景7：最终对决
- 场景8：解决冲突
- 场景9：故事收尾`;
                        break;
                    case 6: // 创作蓝图
                        content = `## 完整创作蓝图
基于您的所有设定，这里是完整的小说创作指导。

### 创作建议
1. 保持核心冲突的连贯性
2. 确保角色发展符合逻辑
3. 平衡情节节奏和情感表达

### 下一步行动
- 开始撰写第一章
- 细化角色背景和动机
- 完善世界观细节`;
                        break;
                    default:
                        content = `这是${STEPS[step].title}的生成内容。基于您的前期设定，这里将展示详细的故事元素。`;
                }

                setGeneratedData(prev => ({
                    ...prev,
                    [STEPS[step].id]: content
                }));
            };

            const renderStepContent = () => {
                const step = STEPS[currentStep];
                
                switch (step.id) {
                    case 'init':
                        return React.createElement('div', { className: 'space-y-6' }, [
                            React.createElement('h2', { key: 'title', className: 'text-2xl font-bold text-white mb-6' }, '创作初始化'),
                            React.createElement('div', { key: 'form', className: 'grid grid-cols-1 md:grid-cols-2 gap-6' }, [
                                React.createElement('div', { key: 'topic' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '核心脑洞'),
                                    React.createElement('textarea', {
                                        value: inputs.topic,
                                        onChange: (e) => setInputs(prev => ({ ...prev, topic: e.target.value })),
                                        placeholder: '请输入您的核心创意脑洞...',
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none',
                                        rows: 3
                                    })
                                ]),
                                React.createElement('div', { key: 'genre' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '题材分类'),
                                    React.createElement('select', {
                                        value: inputs.genre,
                                        onChange: (e) => setInputs(prev => ({ ...prev, genre: e.target.value })),
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 outline-none'
                                    }, [
                                        React.createElement('option', { key: 'default', value: '' }, '选择题材'),
                                        ...TAGS.male.map(tag => React.createElement('option', { key: tag, value: tag }, tag))
                                    ])
                                ]),
                                React.createElement('div', { key: 'novelTitle' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '小说名称'),
                                    React.createElement('input', {
                                        type: 'text',
                                        value: inputs.novelTitle,
                                        onChange: (e) => setInputs(prev => ({ ...prev, novelTitle: e.target.value })),
                                        placeholder: '请输入小说名称...',
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none'
                                    })
                                ]),
                                React.createElement('div', { key: 'tone' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '故事基调'),
                                    React.createElement('select', {
                                        value: inputs.tone,
                                        onChange: (e) => setInputs(prev => ({ ...prev, tone: e.target.value })),
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 outline-none'
                                    }, [
                                        React.createElement('option', { key: 'default', value: '' }, '选择基调'),
                                        ...STORY_TONES.map(tone => React.createElement('option', { key: tone.value, value: tone.value }, tone.label))
                                    ])
                                ]),
                                React.createElement('div', { key: 'ending' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '结局倾向'),
                                    React.createElement('select', {
                                        value: inputs.ending,
                                        onChange: (e) => setInputs(prev => ({ ...prev, ending: e.target.value })),
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 outline-none'
                                    }, [
                                        React.createElement('option', { key: 'default', value: '' }, '选择结局'),
                                        ...ENDING_TYPES.map(type => React.createElement('option', { key: type.value, value: type.value }, type.label))
                                    ])
                                ]),
                                React.createElement('div', { key: 'perspective' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '叙事视角'),
                                    React.createElement('select', {
                                        value: inputs.perspective,
                                        onChange: (e) => setInputs(prev => ({ ...prev, perspective: e.target.value })),
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 outline-none'
                                    }, [
                                        React.createElement('option', { key: 'default', value: '' }, '选择视角'),
                                        ...NARRATIVE_PERSPECTIVES.map(perspective => React.createElement('option', { key: perspective.value, value: perspective.value }, perspective.label))
                                    ])
                                ]),
                                React.createElement('div', { key: 'numberOfChapters' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '预计章节数'),
                                    React.createElement('input', {
                                        type: 'number',
                                        value: inputs.numberOfChapters,
                                        onChange: (e) => setInputs(prev => ({ ...prev, numberOfChapters: e.target.value })),
                                        placeholder: '请输入预计章节数...',
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none'
                                    })
                                ]),
                                React.createElement('div', { key: 'wordCount' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '每章字数'),
                                    React.createElement('input', {
                                        type: 'number',
                                        value: inputs.wordCount,
                                        onChange: (e) => setInputs(prev => ({ ...prev, wordCount: e.target.value })),
                                        placeholder: '请输入每章字数...',
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none'
                                    })
                                ]),
                                React.createElement('div', { key: 'customRequirements', className: 'md:col-span-2' }, [
                                    React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '自定义特殊要求'),
                                    React.createElement('textarea', {
                                        value: inputs.customRequirements,
                                        onChange: (e) => setInputs(prev => ({ ...prev, customRequirements: e.target.value })),
                                        placeholder: '请输入您的特殊要求...',
                                        className: 'w-full bg-stone-900 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none',
                                        rows: 4
                                    })
                                ])
                            ]),
                            React.createElement('button', {
                                key: 'generate',
                                onClick: () => handleGenerate(currentStep),
                                disabled: isGenerating || !inputs.topic || !inputs.genre,
                                className: `w-full py-3 px-6 rounded-lg font-semibold transition-all ${isGenerating || !inputs.topic || !inputs.genre
                                    ? 'bg-stone-700 text-stone-400 cursor-not-allowed'
                                    : 'bg-orange-600 hover:bg-orange-500 text-white shadow-lg shadow-orange-900/20'
                                }`
                            }, isGenerating ? [
                                React.createElement('div', { key: 'spinner', className: 'loading-spinner inline-block mr-2' }),
                                '生成中...'
                            ] : '开始创作初始化')
                        ]);

                    default:
                        const content = generatedData[step.id];
                        return React.createElement('div', { className: 'space-y-6' }, [
                            React.createElement('h2', { key: 'title', className: 'text-2xl font-bold text-white mb-6' }, step.title),
                            content ? React.createElement('div', {
                                key: 'content',
                                className: 'min-h-64 p-6 bg-stone-900 rounded-lg border border-stone-800 markdown-content'
                            }, React.createElement('div', {
                                dangerouslySetInnerHTML: { __html: content.replace(/^# (.*$)/gm, '<h1 class="text-2xl font-bold">$1</h1>')
                                    .replace(/^## (.*$)/gm, '<h2 class="text-xl font-bold">$1</h2>')
                                    .replace(/^### (.*$)/gm, '<h3 class="text-lg font-bold">$1</h3>')
                                    .replace(/^(?!#)([\s\S]*?)(?=^#|\n\n|$)/gm, '<p>$1</p>')
                                    .replace(/```([\s\S]*?)```/gm, '<pre><code>$1</code></pre>')
                                    .replace(/`([^`]+)`/g, '<code>$1</code>')}
                            })) : React.createElement('div', {
                                key: 'empty',
                                className: 'text-center py-12 text-stone-500'
                            }, '暂无内容，请先生成此步骤的内容'),
                            React.createElement('button', {
                                key: 'generate',
                                onClick: () => handleGenerate(currentStep),
                                disabled: isGenerating,
                                className: `w-full py-3 px-6 rounded-lg font-semibold transition-all ${isGenerating
                                    ? 'bg-stone-700 text-stone-400 cursor-not-allowed'
                                    : 'bg-orange-600 hover:bg-orange-500 text-white shadow-lg shadow-orange-900/20'
                                }`
                            }, isGenerating ? [
                                React.createElement('div', { key: 'spinner', className: 'loading-spinner inline-block mr-2' }),
                                '生成中...'
                            ] : `生成${step.title}`)
                        ]);
                }
            };

            // 配置模态框组件
            const ConfigModal = () => {
                const [localConfig, setLocalConfig] = React.useState(apiConfig);

                const handleSave = () => {
                    handleConfigSave(localConfig);
                    setShowConfigModal(false);
                };

                return React.createElement('div', { className: 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4' }, [
                    React.createElement('div', { className: 'bg-stone-900 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto' }, [
                        React.createElement('div', { className: 'p-6 border-b border-stone-800' }, [
                            React.createElement('h3', { className: 'text-xl font-bold text-white' }, 'API配置'),
                            React.createElement('p', { className: 'text-stone-400 mt-1' }, '设置AI服务提供商和API密钥')
                        ]),
                        React.createElement('div', { className: 'p-6 space-y-4' }, [
                            React.createElement('div', null, [
                                React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '服务提供商'),
                                React.createElement('select', {
                                    value: localConfig.provider,
                                    onChange: (e) => setLocalConfig(prev => ({ ...prev, provider: e.target.value })),
                                    className: 'w-full bg-stone-800 border border-stone-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 outline-none'
                                }, [
                                    React.createElement('option', { value: 'google' }, 'Google Gemini'),
                                    React.createElement('option', { value: 'openai' }, 'OpenAI'),
                                    React.createElement('option', { value: 'claude' }, 'Anthropic Claude')
                                ])
                            ]),
                            React.createElement('div', null, [
                                React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, 'API密钥'),
                                React.createElement('input', {
                                    type: 'password',
                                    value: localConfig.apiKey,
                                    onChange: (e) => setLocalConfig(prev => ({ ...prev, apiKey: e.target.value })),
                                    placeholder: '请输入API密钥...',
                                    className: 'w-full bg-stone-800 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none'
                                })
                            ]),
                            React.createElement('div', null, [
                                React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, 'API基础URL'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: localConfig.baseUrl,
                                    onChange: (e) => setLocalConfig(prev => ({ ...prev, baseUrl: e.target.value })),
                                    placeholder: '请输入API基础URL...',
                                    className: 'w-full bg-stone-800 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none'
                                })
                            ]),
                            React.createElement('div', null, [
                                React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '文本模型'),
                                React.createElement('select', {
                                    value: localConfig.textModel,
                                    onChange: (e) => setLocalConfig(prev => ({ ...prev, textModel: e.target.value })),
                                    className: 'w-full bg-stone-800 border border-stone-700 rounded-lg px-4 py-3 text-white focus:border-orange-500 outline-none'
                                }, [
                                    React.createElement('option', { value: 'gemini-2.5-flash' }, 'gemini-2.5-flash'),
                                    React.createElement('option', { value: 'gemini-2.5-pro' }, 'gemini-2.5-pro'),
                                    React.createElement('option', { value: 'custom' }, '自定义模型')
                                ])
                            ]),
                            localConfig.textModel === 'custom' && React.createElement('div', null, [
                                React.createElement('label', { className: 'block text-sm font-medium text-stone-400 mb-2' }, '自定义模型名称'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: localConfig.customTextModel || '',
                                    onChange: (e) => setLocalConfig(prev => ({ ...prev, customTextModel: e.target.value })),
                                    placeholder: '请输入自定义模型名称...',
                                    className: 'w-full bg-stone-800 border border-stone-700 rounded-lg px-4 py-3 text-white placeholder-stone-500 focus:border-orange-500 outline-none'
                                })
                            ])
                        ]),
                        React.createElement('div', { className: 'p-6 border-t border-stone-800 flex justify-end space-x-3' }, [
                            React.createElement('button', {
                                onClick: () => setShowConfigModal(false),
                                className: 'px-6 py-2 rounded-lg bg-stone-800 text-stone-400 hover:bg-stone-700 transition-colors'
                            }, '取消'),
                            React.createElement('button', {
                                onClick: handleSave,
                                className: 'px-6 py-2 rounded-lg bg-orange-600 text-white hover:bg-orange-500 transition-colors'
                            }, '保存')
                        ])
                    ])
                ]);
            };

            return React.createElement('div', { className: 'min-h-screen bg-stone-950' }, [
                // 头部
                React.createElement('header', { className: 'bg-stone-900 border-b border-stone-800 shadow-lg' }, [
                    React.createElement('div', { className: 'container mx-auto px-4 py-6 flex justify-between items-center' }, [
                        React.createElement('div', { className: 'flex items-center space-x-3' }, [
                            React.createElement('div', { className: 'bg-orange-600 p-2 rounded-lg' }, [
                                React.createElement('span', { className: 'text-white font-bold text-xl' }, 'DS')
                            ]),
                            React.createElement('div', null, [
                                React.createElement('h1', { className: 'text-2xl font-bold text-white' }, 'DeepStory AI'),
                                React.createElement('p', { className: 'text-stone-400 text-sm' }, '智能小说创作工具')
                            ])
                        ]),
                        React.createElement('button', {
                            onClick: () => setShowConfigModal(true),
                            className: 'px-4 py-2 bg-stone-800 text-stone-300 rounded-lg hover:bg-stone-700 transition-colors flex items-center space-x-2'
                        }, [
                            React.createElement('span', null, '⚙️'),
                            React.createElement('span', null, '配置')
                        ])
                    ])
                ]),

                // 主体内容
                React.createElement('main', { className: 'container mx-auto px-4 py-8' }, [
                    React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-4 gap-6' }, [
                        // 步骤导航
                        React.createElement('div', { className: 'lg:col-span-1' }, [
                            React.createElement('div', { className: 'bg-stone-900 rounded-xl shadow-lg border border-stone-800 p-4' }, [
                                React.createElement('h3', { className: 'text-lg font-bold text-white mb-4' }, '创作步骤'),
                                React.createElement('div', { className: 'space-y-2' }, STEPS.map((step, index) => (
                                    React.createElement('button', {
                                        key: step.id,
                                        onClick: () => setCurrentStep(index),
                                        className: `w-full text-left px-4 py-3 rounded-lg transition-all ${index === currentStep
                                            ? 'bg-orange-600 text-white shadow-lg shadow-orange-900/20'
                                            : 'bg-stone-800 text-stone-400 hover:bg-stone-700'
                                        }`
                                    }, [
                                        React.createElement('div', { className: 'font-medium' }, step.title),
                                        React.createElement('div', { className: 'text-xs text-stone-500' }, step.description)
                                    ])
                                )))
                            ])
                        ]),

                        // 主要内容
                        React.createElement('div', { className: 'lg:col-span-3' }, [
                            React.createElement('div', { className: 'bg-stone-900 rounded-xl shadow-lg border border-stone-800 p-6' }, [
                                renderStepContent(),
                                
                                React.createElement('div', {
                                    className: 'flex justify-between mt-8'
                                }, [
                                    React.createElement('button', {
                                        onClick: () => setCurrentStep(Math.max(0, currentStep - 1)),
                                        disabled: currentStep === 0,
                                        className: `px-6 py-2 rounded-lg transition-colors ${currentStep === 0
                                            ? 'bg-stone-800 text-stone-500 cursor-not-allowed'
                                            : 'bg-stone-700 hover:bg-stone-600 text-white'
                                        }`
                                    }, '上一步'),
                                    React.createElement('button', {
                                        onClick: () => setCurrentStep(Math.min(STEPS.length - 1, currentStep + 1)),
                                        disabled: currentStep === STEPS.length - 1,
                                        className: `px-6 py-2 rounded-lg transition-colors ${currentStep === STEPS.length - 1
                                            ? 'bg-stone-800 text-stone-500 cursor-not-allowed'
                                            : 'bg-orange-600 hover:bg-orange-500 text-white'
                                        }`
                                    }, '下一步')
                                ])
                            ])
                        ])
                    ])
                ]),

                // 页脚
                React.createElement('footer', { className: 'mt-12 py-6 bg-stone-900 border-t border-stone-800' }, [
                    React.createElement('div', { className: 'container mx-auto px-4 text-center text-stone-500 text-sm' }, [
                        React.createElement('p', null, 'DeepStory AI - 智能小说创作工具 © 2025'),
                        React.createElement('p', { className: 'mt-2' }, '使用AI技术辅助小说创作，释放无限创意')
                    ])
                ]),

                // 配置模态框
                showConfigModal && React.createElement(ConfigModal, null)
            ]);
        };

        // 渲染应用
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(React.StrictMode, null, 
            React.createElement(AlertProvider, null, 
                React.createElement(App, null)
            )
        ));
    </script>
</body>
</html>
**问题分析**：
在 `App.tsx` 文件的 `handleGenerateChapter` 函数中，第 315 行使用了 `nextChapterPurpose` 变量，但这个变量没有被定义，导致章节生成时出现 `nextChapterPurpose is not defined` 错误。

**修复方案**：
1. 在 `handleGenerateChapter` 函数中添加 `nextChapterPurpose` 变量的定义和初始化
2. 参考 `generateFullPrompt` 函数的逻辑，从章节蓝图中提取下一章的核心作用
3. 如果没有找到下一章的信息，则使用默认值 "承接剧情"

**修改位置**：
- `App.tsx:272-340`：`handleGenerateChapter` 函数

**具体修改内容**：
在 `handleGenerateChapter` 函数中，在定义 `variables` 对象之前，添加以下代码：
```typescript
// 从章节蓝图中获取当前章节和下章信息
let nextChapterPurpose = "承接剧情";

// 解析章节蓝图获取下章信息
if (generatedData.blueprint) {
    const blueprintLines = generatedData.blueprint.split('\n');
    const nextChapterRegex = new RegExp(`### 第${chapterNum + 1}章 -`);
    
    let inNextChapter = false;
    for (const line of blueprintLines) {
        if (nextChapterRegex.test(line)) {
            inNextChapter = true;
        } else if (inNextChapter) {
            // 提取下一章的核心作用
            if (line.includes('**核心作用：**')) {
                nextChapterPurpose = line.replace('**核心作用：**', '').trim();
                break; // 找到下一章作用后退出循环
            }
        }
    }
}
```

**预期效果**：
修复后，章节生成时将正确定义和使用 `nextChapterPurpose` 变量，不再出现 "nextChapterPurpose is not defined" 错误。
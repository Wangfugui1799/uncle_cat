# 修复完整提示词中剧情结构未替换问题

## 问题分析
在情节架构的完整提示词中，`{plot_structure}` 占位符没有被替换成用户选择的剧情结构，主要原因是 `generateFullPrompt` 函数中缺少对 `plot_structure` 变量的处理：

1. **前端显示问题**：
   - 当用户查看完整提示词时，调用 `generateFullPrompt` 函数
   - 该函数在处理 PLOT 等提示词时，创建的 `variables` 对象中缺少 `plot_structure` 变量
   - 导致 `formatPrompt` 函数无法替换 `{plot_structure}` 占位符

2. **实际生成不受影响**：
   - 实际生成情节架构时使用 `handleGenerateStep` 函数
   - 该函数已经包含 `plot_structure` 变量的处理
   - 所以生成结果是正确的，只有前端显示的完整提示词有问题

## 修复方案

### 1. 更新 generateFullPrompt 函数
修改 `generateFullPrompt` 函数，在处理 PLOT 等提示词时，将 `selectedPlotStructure` 状态值添加到 `variables` 对象中：
- 在 else 分支（通用提示词变量）中添加 `plot_structure` 变量
- 确保该变量使用 `selectedPlotStructure` 状态值

### 2. 验证修复
- 确保所有类型的提示词都能正确处理 `plot_structure` 变量
- 验证前端显示的完整提示词中 `{plot_structure}` 占位符被正确替换
- 确保实际生成功能不受影响

## 实现步骤

1. **修改 App.tsx**：
   - 更新 `generateFullPrompt` 函数
   - 在 else 分支的 `variables` 对象中添加 `plot_structure` 变量
   - 确保变量值为 `selectedPlotStructure` 状态值

2. **验证修复**：
   - 运行构建命令确保没有错误
   - 测试完整提示词生成功能
   - 验证 `{plot_structure}` 占位符被正确替换

## 预期效果
- 前端显示的完整提示词中 `{plot_structure}` 占位符将被正确替换成用户选择的剧情结构
- 实际生成功能不受影响
- 完整提示词将准确反映用户的选择

## 文件修改
- `App.tsx`: 更新 `generateFullPrompt` 函数，添加 `plot_structure` 变量

## 实现代码示例
```typescript
// 通用提示词变量
variables = {
    novel_title: String(inputs.novelTitle || "未命名"),
    topic: String(inputs.topic || ""),
    genre: String(inputs.genre || ""),
    tone: String(inputs.tone || "未指定"),
    ending: String(inputs.ending || "未指定"),
    perspective: String(inputs.perspective || "未指定"),
    number_of_chapters: String(inputs.numberOfChapters || 10),
    word_count: String(inputs.wordCount || 2000),
    custom_requirements: String(inputs.customRequirements || "无"),
    custom_instruction: customInstruction,
    STORY_DNA: String(generatedData.dna || "暂无核心DNA"),
    character_dynamics: String(generatedData.characters || "暂无角色设定"),
    world_building: String(generatedData.world || "暂无世界观设定"),
    plot_architecture: String(generatedData.plot || "暂无情节架构"),
    plot_structure: selectedPlotStructure // 添加这行
};
```
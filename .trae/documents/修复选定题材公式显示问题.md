**问题分析**：

1. **Props 不匹配**：`WritingStep` 组件接收了 `onUpdateSelectedTheme` 和 `selectedTheme` props，但在组件的 Props 接口中没有定义这些 props

2. **状态管理不一致**：组件内部使用了自己的 `selectedTheme` 状态，而不是使用父组件传递的 `selectedTheme` prop

3. **回调函数未调用**：当用户选择主题时，组件更新了自己的 `selectedTheme` 状态，但没有调用 `onUpdateSelectedTheme` 回调函数来更新父组件的状态

4. **主题信息未同步**：由于父组件的 `writingStepState.selectedTheme` 没有被更新，`generateFullPrompt` 函数无法获取到选定的主题信息，导致 `selected_theme_info` 变量始终显示为 "未指定特定题材公式，请自行发挥"

**解决方案**：

1. **更新 Props 接口**：在 `WritingStep` 组件的 Props 接口中添加缺少的 props

2. **使用父组件传递的状态**：在组件中使用父组件传递的 `viewChapter` 和 `selectedTheme` prop，而不是自己的状态

3. **调用回调函数**：当主题选择变化时，调用 `onUpdateSelectedTheme` 回调函数更新父组件的状态

4. **修复章节切换逻辑**：当章节切换时，调用 `onUpdateViewChapter` 回调函数更新父组件的状态

**修改内容**：

1. **更新 WritingStep 组件的 Props 接口**：

   ```typescript
   interface Props {
       // 现有 props...
       onUpdateViewChapter: (chapterNum: number) => void;
       onUpdateSelectedTheme: (theme: any) => void;
       viewChapter: number;
       selectedTheme: any;
   }
   ```

2. **修改 WritingStep 组件的函数参数**：

   ```typescript
   const WritingStep: React.FC<Props> = ({
       // 现有 props...
       onUpdateViewChapter,
       onUpdateSelectedTheme,
       viewChapter,
       selectedTheme
   }) => {
       // 移除自己的状态定义，使用父组件传递的 prop
       // const [viewChapter, setViewChapter] = useState(1);
       // const [selectedTheme, setSelectedTheme] = useState<ThemeMatch | null>(null);
   }
   ```

3. **修改章节切换逻辑**：

   ```typescript
   // 前一章按钮
   onClick={() => {
       const newChapterNum = viewChapter - 1;
       onUpdateViewChapter(newChapterNum);
       setAudioUrl(null);
       setIsPlaying(false);
   }}

   // 后一章按钮
   onClick={() => {
       if (viewChapter < (inputs.numberOfChapters || 12)) {
           const newChapterNum = viewChapter + 1;
           onUpdateViewChapter(newChapterNum);
           setAudioUrl(null);
           setIsPlaying(false);
           setDemonCritique(null);
           setUserFeedback("");
           setShowFeedbackInput(false);
           setMatchedThemes([]);
           onUpdateSelectedTheme(null);
           setIsEditMode(false);
       }
   }}
   ```

4. **修改主题选择逻辑**：

   ```typescript
   // 主题选择
   onClick={() => {
       const newTheme = selectedTheme?.code === theme.code ? null : theme;
       onUpdateSelectedTheme(newTheme);
   }}
   ```

**预期效果**：

* 当用户在 WritingStep 组件中选择主题时，组件会调用 `onUpdateSelectedTheme` 回调函数

* 父组件的 `writingStepState.selectedTheme` 会被更新

* 当用户打开提示词模态框时，`generateFullPrompt` 函数会获取到正确的选定主题信息

* 完整提示词中的 `selected_theme_info` 会显示选定的题材公式，而不是 "未指定特定题材公式，请自行发挥"

**修改位置**：

* `components/WritingStep.tsx`：更新 Props 接口和组件实现，修复主题选择和章节切换逻辑

**技术要点**：

* 确保组件使用父组件传递的状态，而不是自己的状态

* 当组件内部状态变化时，调用回调函数更新父组件的状态

* 保持父组件和子组件之间的状态同步

* 确保 generateFullPrompt 函数能够获取到最新的主题信息


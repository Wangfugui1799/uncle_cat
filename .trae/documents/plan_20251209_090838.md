# 修复核心DNA页面基础设定重复显示问题

## 问题分析

核心DNA页面基础设定重复显示的原因：

1. **双重复制**：当前代码同时渲染了两个基础设定
   - 一个是前端手动构建的 `initialContentMarkdown`（使用 `inputs` 数据）
   - 另一个是AI生成的完整内容，其中已经包含了基础设定（BASIC_SETTINGS）

2. **模板设计问题**：修改后的 `PROMPTS.DNA` 模板生成的结果包含了基础设定和核心DNA

3. **渲染逻辑冲突**：前端代码没有考虑到AI生成结果中已经包含了基础设定

## 解决方案

### 方案1：移除前端手动构建的基础设定

修改核心DNA页面的渲染逻辑，只显示AI生成的完整内容，不再手动构建和显示基础设定。

### 方案2：从AI生成结果中提取核心DNA

修改渲染逻辑，从AI生成的结果中只提取核心DNA部分显示，忽略其中的基础设定。

### 推荐方案

**方案1** 更优，因为：
- 保持了AI生成结果的完整性
- 避免了前端和AI生成内容的重复
- 简化了渲染逻辑
- 确保了基础设定和核心DNA的一致性

## 实现步骤

### 1. 修改核心DNA页面渲染逻辑

```typescript
if (currentStepId === 'dna') {
    return (
        <div className="h-full flex flex-col space-y-4">
            {/* Action Bar */}
            <div className="flex justify-between items-center bg-stone-900 p-4 rounded-xl border border-stone-800">
                {/* ... 工具栏内容保持不变 ... */}
            </div>

            {/* 只有当内容存在时才显示 */}
            {content ? (
                <div className="flex-1 bg-stone-900 border border-stone-800 rounded-xl p-6 shadow-xl overflow-y-auto">
                    <div className="flex justify-end mb-4">
                        <button 
                            onClick={() => copyToClipboard(content)} 
                            className="text-stone-500 hover:text-white transition-colors p-2 rounded-lg hover:bg-stone-800"
                            title="复制核心DNA"
                        >
                            <Copy size={18} />
                        </button>
                    </div>
                    <MarkdownViewer content={content} />
                </div>
            ) : (
                // 生成按钮和提示
                <div className="flex-1 bg-stone-900 border border-stone-800 rounded-xl p-6 shadow-xl flex flex-col items-center justify-center">
                    {/* ... 生成按钮内容保持不变 ... */}
                </div>
            )}
        </div>
    );
}
```

### 2. 保持其他渲染逻辑不变

- 工具栏内容保持不变
- 生成按钮和提示内容保持不变
- 其他步骤的渲染逻辑保持不变

## 预期效果

1. **不再重复显示**：基础设定只显示一次（来自AI生成结果）
2. **保持完整性**：AI生成的完整结果（包含基础设定和核心DNA）都能显示
3. **简化逻辑**：移除了冗余的手动构建代码
4. **保持一致性**：基础设定和核心DNA来自同一AI生成结果，确保一致性

## 实现注意事项

1. 确保AI生成结果的格式正确，包含基础设定和核心DNA
2. 保持Markdown渲染器能正确处理AI生成的格式
3. 确保复制功能能复制完整的AI生成结果

## 测试计划

1. 测试核心DNA生成功能
2. 验证生成结果中基础设定只显示一次
3. 测试复制功能
4. 测试其他步骤的渲染是否受影响


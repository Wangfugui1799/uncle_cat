**问题分析**：

* 当从后续章节提示词切回到首章创作提示词时，完整提示词中的章节信息显示的是之前在后续章节里看过的章节，而不是第1章

* 从截图可以看出，虽然顶部显示的是"首章创作(CHAPTER\_1)"和"第1章"，但完整提示词中的章节信息显示的是"第10章"

* 这是因为 `generateFullPrompt` 函数中的章节号逻辑存在问题

**根本原因**：

* 在 `generateFullPrompt` 函数中，第 482 行：

  ```typescript
  const currentChapterNum = chapterNum || writingStepState.viewChapter || 1;
  ```

* 这里的逻辑是：如果传入了 `chapterNum`，就使用它；否则使用 `writingStepState.viewChapter`；如果都没有，就使用默认值1

* 问题在于，当用户在提示词专家下拉框中切换提示词时，虽然章节选择器的显示更新了，但 `generateFullPrompt` 函数没有根据新的 `promptKey` 来调整章节号

* 对于首章创作（`CHAPTER_1`），无论当前 `writingStepState.viewChapter` 是什么，都应该强制使用第1章

**解决方案**：

* 修改 `generateFullPrompt` 函数，根据 `promptKey` 来强制设置正确的章节号

* 当 `promptKey === 'CHAPTER_1'` 时，强制使用第1章

* 当 `promptKey === 'CHAPTER_NEXT'` 时，确保章节号大于等于2

**修改内容**：

1. **修改** **`generateFullPrompt`** **函数中的章节号逻辑**：

   * 添加条件判断，根据 `promptKey` 调整章节号

   * 当 `promptKey === 'CHAPTER_1'` 时，强制设置 `currentChapterNum = 1`

   * 当 `promptKey === 'CHAPTER_NEXT'` 时，确保 `currentChapterNum >= 2`

**修改位置**：

* `App.tsx`：`generateFullPrompt` 函数

**预期效果**：

* 当选择"首章创作(CHAPTER\_1)"时，无论之前查看的是哪个章节，完整提示词中的章节信息都会显示第1章

* 当选择"后续章节(CHAPTER\_NEXT)"时，完整提示词中的章节信息会显示第2章及以后的章节

* 确保了提示词与章节的正确对应关系

**技术要点**：

* 使用条件判断根据 `promptKey` 强制设置章节号

* 保持与章节选择器逻辑的一致性

* 确保用户体验的准确性和一致性


# 修复核心DNA生成问题

## 问题分析

核心DNA生成失败的原因是：

1. **模板设计问题**：当前 `PROMPTS.DNA` 模板仍然要求AI提示用户提供完整创作设置
2. **变量传递问题**：虽然前端传递了所有创作初始化变量，但模板没有正确使用这些变量
3. **AI交互问题**：AI收到的提示词包含了"请提供您的完整创作设置"，导致AI等待用户输入而不是直接生成

## 解决方案

### 更新DNA生成模板

修改 `PROMPTS.DNA` 模板，移除要求用户提供创作设置的部分，让AI直接使用传递的变量生成核心DNA。

### 具体修改内容

```typescript
// 在 constants.ts 中更新 PROMPTS.DNA
PROMPTS.DNA = `
# 小说核心DNA生成专家
你是一位专业的故事架构师，专门创建小说的核心DNA。你的任务是将用户的创作意图转化为一个精准的故事公式。

## 指令
基于用户提供的完整创作设置，生成一个包含基础设定和核心DNA的完整结果。
**重要：** 如果用户提供了【自定义特殊要求】，请务必优先遵循，并对基础设定和DNA进行相应的调整。

## 思维链
1.  **理解用户意图**：深入分析用户提供的所有设置信息，包括小说名称、核心脑洞、题材分类、叙事视角、基调、结局倾向、篇幅规划和自定义要求。
2.  **识别核心冲突模式**：根据题材分类和核心脑洞，识别并提炼出该故事的核心冲突模式。
3.  **构建完整结果**：生成包含更新后的基础设定和核心DNA的完整输出。

## 输入信息

**基础设定：**
- 小说名称：{novel_title}
- 核心脑洞：{topic}
- 题材分类：{genre}

**叙事风格：**
- 叙事视角：{perspective}
- 故事基调：{tone}
- 结局倾向：{ending}

**篇幅规划：**
- 预计章节数：{number_of_chapters}章
- 每章字数：{word_count}字

**特殊要求：**
- 自定义特殊要求：{custom_requirements}
- 修改指令：{custom_instruction}

### 生成结果
\`\`\`
## 基础设定 (BASIC_SETTINGS)
- 小说名称：{novel_title}
- 核心脑洞：{topic}
- 题材分类：{genre}
- 叙事视角：{perspective}
- 故事基调：{tone}
- 结局倾向：{ending}
- 预计章节数：{number_of_chapters}章
- 每章字数：{word_count}字
- 自定义特殊要求：{custom_requirements}

## 核心DNA (STORY_DNA)
当[具体的主角描述]遭遇[核心冲突事件]，必须[关键行动选择]，否则[具体的灾难后果]；与此同时，[隐藏的更大危机]正在悄然发酵。
\`\`\`
`;
```

## 预期效果

1. **直接生成**：AI收到提示词后直接生成核心DNA，不再等待用户输入
2. **正确使用变量**：模板中的所有变量将被正确替换为创作初始化内容
3. **保持格式一致**：生成的内容格式与原格式保持一致
4. **提高用户体验**：用户点击"立即生成"后，AI直接生成核心DNA，无需额外交互

## 实现步骤

1. **更新DNA模板**：修改 `constants.ts` 中的 `PROMPTS.DNA` 模板
2. **测试生成功能**：确保核心DNA生成功能正常工作
3. **验证格式一致性**：确保生成的内容格式符合预期

## 测试计划

1. 测试核心DNA立即生成功能
2. 验证生成的内容包含正确的创作初始化信息
3. 检查生成的格式是否与原格式一致
4. 测试不同创作初始化内容的生成效果

